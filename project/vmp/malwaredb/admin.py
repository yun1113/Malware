from django.contrib import admin
from kombu.transport.django import models as kombu_models
from malwaredb.models import Malware, Upload, VirusTotalInfo
from malwaredb.tasks import profiling


class MalwareAdmin(admin.ModelAdmin):
    list_display = ('hash', 'submissiondate', 'create_hooklog_state')
    search_fields = ('hash', 'submissiondate', )
    actions = ['reprofiling']

    def reprofiling(self, request, queryset):
        for obj in queryset:
            profiling.delay(obj.hash)
    reprofiling.short_description = "Reprofiling"


class UploadAdmin(admin.ModelAdmin):
    list_display = ('name', 'hash', 'submissiondate', 'user_account')
    search_fields = ('hash', 'submissiondate', 'user_account__user__username')


class VirusTotalInfoAdmin(admin.ModelAdmin):
    list_display = ('vendor', 'md5')
    search_fields = ('md5',)

admin.site.register(Malware, MalwareAdmin)
admin.site.register(Upload, UploadAdmin)
admin.site.register(VirusTotalInfo, VirusTotalInfoAdmin)


# Celery
admin.site.register(kombu_models.Message)
