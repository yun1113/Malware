#code for python3.x
import simplejson #simplejson should be installed first
import urllib #
#import urllib2 urllib2 merged into urllib in pyhton3
import urllib.request
import urllib.parse

def getApi(hash):
        url = "https://www.virustotal.com/vtapi/v2/file/report"
        #parameters = {"resource":"545dbb7f469b49a7bbcd56eadc20123edeba469f4bcf9d080ab010f81be9673b","apikey":"92b3ab3619912133954ace582818162e4f0bba82cd2a994c7c894ef9f52bf9a5"}
        parameters = {"resource":hash,"apikey":"92b3ab3619912133954ace582818162e4f0bba82cd2a994c7c894ef9f52bf9a5"}
        data = urllib.parse.urlencode(parameters)
        binary_data = data.encode("utf8")
        req = urllib.request.Request(url,binary_data)
        response = urllib.request.urlopen(req)
        json = response.read()
        #print(json)

        fout = open('/usr/src/app/vmp/malwaredb/virus_total/'+ hash,'wb')
        fout.write(json)
        size = len(json)
        offset = 0
        chunk = 100
        #finish = False
        while offset <= size:
        #    if offset > size:
        #        break
                fout.write(json[offset:offset+chunk])
                offset += chunk
        fout.close()

