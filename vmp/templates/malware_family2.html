{% extends 'base.html' %}
{% load static %}

{% block body %}

<div class="container-fluid malware_info">
    <ul class="nav nav-tabs">
        <li class="active"><a data-toggle="tab" href="#home"><b>Family info</b></a></li>
        <li>
            <a data-toggle="tab" href="#menu2"><b>Stage Sequence</b></a>
        </li>
        <li>
            <a data-toggle="tab" href="#menu3"><b>Motif CDF</b></a>
        </li> 
        <li>
            <a data-toggle="tab" href="#menu4"><b>Common Motif Sequence</b></a>
        </li>       
        <li>
            <a data-toggle="tab" href="#menu5"><b>Def-use Chain</b></a>
        </li>
    </ul>

    <div class="tab-content">
        <div id="home" class="tab-pane fade in active">
            <div class="panel-body" style="background-color: #F2EEDF;">
                <h2 style="text-indent: 20px;"><b>Malware Family: {{ family.name }}</b></h2>
                <table id="family-table">
                    <tr>
                        {% for family_info in family.family_infos %}
                            <td><h3><b>{{ family_info.illustration}}</b></h3></td>
                        {% endfor %}
                    </tr>
                    <tr>
                        {% for family_info in family.family_infos %}
                            <td>
                                <i class="fa fa-dot-circle-o" aria-hidden="true"></i>&nbsp;<b>{{ family_info.process }}</b>
                                {% for action in family_info.actions %}
                                    <li><i class="fa fa-circle" aria-hidden="true"></i>&nbsp;{{ action }}</li>
                                {% endfor %}
                            </td>
                        {% endfor %}
                    </tr>
                    <tr>
                        {% for family_info in family.family_infos %}
                            <td><b>(In execution trace profile)</b>
                            {% for api in family_info.apis %}
                            <li style="font-size: 18px; padding-top: 20px;"><i class="fa fa-circle" aria-hidden="true"></i>&nbsp;{{ api.api_name }}</li>
                            <p style="font-size: 18px;">{{ api.detail }}</p>
                            {% endfor %}
                            </td>
                        {% endfor %}
                    </tr>
                </table>
            </div>
        </div>


       <div id="menu2" class="tab-pane fade">
            <div class="panel-body" style="background: #F2EEDF !important;">
                <h2 ><b>Malware Family: {{ family.name }}</b></h2>
                <div class="illustration">
                    <p><i class="fa fa-bullseye" aria-hidden="true"></i>&nbsp; Legend</p>
                     <img src="{% static 'image/family/for_all/stage_sequence_legend.PNG' %}" style="width: 500px;">
                </div>
                <p style="font-size: 14px; color: gray; display: inline;">(Click to enlarge)</p>
                <div id="image-gallery-1" class="cf" style="padding-top: 10px;">
                    <img src="{% static family.stage_sequence %}" data-high-res-src="{% static family.stage_sequence %}" alt="" class="profile-picture">
                </div>
            </div>
        </div>


        <div id="menu3" class="tab-pane fade">
            <div class="panel-body" style="background-color: #F2EEDF;">
                <div class="" style=" padding: 10px; margin-bottom: 10px;">
                    <h2><b>Malware Family: {{ family.name }}</b></h2>
                    <p style="text-indent: 25px;"><i class="fa fa-bullseye" aria-hidden="true"></i>&nbsp;The Cumulative Distribution Functions (CDF) of the Motif Length</p>
                </div>
                <img src="{% static family.cdf  %}" style="width: 800px; display: block; margin: auto;">
            </div>
        </div>


        <div id="menu4" class="tab-pane fade">
            <div class="panel-body"style="background: #F2EEDF !important;">
                <h2><b>Malware Family: {{ family.name }}</b></h2>
                <div class="illustration">
                    <p><i class="fa fa-bullseye" aria-hidden="true"></i>&nbsp; Legend</p>
                    <img src="{% static 'image/family/for_all/common_motif_legen.PNG' %}" style="width: 350px;">
                </div>

                <div class="plot">
                    <p style="display: inline;"><i class="fa fa-bullseye" aria-hidden="true"></i>&nbsp; Family Stage Sequence </p>
                    <p style="font-size: 14px; color: gray; display: inline;">(Click to enlarge)</p>
                    <div id="image-gallery-1" class="cf" style="padding-top: 10px;">
                        <img src="{% static family.common_motif %}" data-high-res-src="{% static family.common_motif %}" alt="" class="gallery-items">
                    </div>
                </div>

                <div class="illustration">
                    <p ><i class="fa fa-bullseye" aria-hidden="true"></i>&nbsp; Summary of API usage statistic of common motifs</p>
                    <img class="text-center" src="{% static family.common_motif_statistic %}" style="width: 600px;">
                </div>
            </div>
        </div>

        
        <div id="menu5" class="tab-pane fade">
            <div class="container-fluid" style="background-color: #F2EEDF;">
                <h2 ><b>Malware Family: {{ family.name }}</b></h2>
                <div class="row">
                    <nav class="col-sm-2" style="padding: 20px 0px 20px 10px;">
                        <ul class="nav nav-pills nav-stacked vertical-nav">
                            <li><a style="margin: auto;" class="selected" href="#section1">State-change Hooked API</a></li>
                            <li><a style="width:100px; margin: auto;" href="#section2">Def-use Chain</a></li>
                            <li><a style="width:70px; margin: auto;" href="#section3">Resource</a></li>
                        </ul>
                    </nav>
                    <div class="col-sm-10">
                        <div class="panel-section" id="section1">
                            <p><i class="fa fa-bullseye" aria-hidden="true"></i>&nbsp; Tagged State-change Hooked APIs and Parameters </p>
                            <table id="APItable">
                                <tr>
                                    <th>Lib</th>
                                    <th>Proc</th>
                                    <th>File</th>
                                    <th>Reg</th>
                                    <th>Net</th>
                                </tr>
                                <tr>
                                    <td>LoadLibrary(lpFileName)
                                    </td>
                                    <td>CreateProcess(lpApplicationName, lpCommandLine)
                                    OpenProcess(dwProcessId)
                                    ExitProcess
                                    WinExec(lpCmdLin)
                                    CloseHandle
                                    CreateRemoteThread
                                    TerminateProcess
                                    TerminateThread
                                    CreateThread(lpThreadId)
                                    OpenThread(dwThreadId)
                                    </td>
                                    <td>CopyFile(lpExistingFileName)
                                    CreateFile(lpFileName)
                                    WriteFile(lpFileName)
                                    ReadFile
                                    DeleteFile(lpFileName)
                                    </td>
                                    <td>RegOpenKey(hKey)
                                    RegCloseKey(hKey)
                                    RegSetValue(hKey)
                                    RegCreateKey(hKey)
                                    RegDeleteKey(hKey)
                                    RegDeleteValue(hKey)
                                    </td>
                                    <td>WinHttpConnect(pwszServerName)
                                    WinHttpCreateUrl(pwszUrl)
                                    WinHttpOpen(pwszUserAgent)
                                    WinHttpOpenRequest(pwszObjectName)
                                    WinHttpReadData(lpBuffer)
                                    WinHttpSenRequest(lpOptional)
                                    WinHttpWriteData(lpBuffer)
                                    WinHttpGetProxyForUrl(lpcwszUrl)
                                    InternetOpen(lpszAgent)
                                    InternetConnect(lpszServerName)
                                    HttpSendRequest(lpOptional)
                                    GetUrlCacheEntryInfo(lpszUrlName)
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="panel-section hidden" id="section2">
                            <p><i class="fa fa-bullseye" aria-hidden="true"></i>&nbsp; The Def-use Chain </p>
                            <img src="{% static family.def_use_chain %}" style="width: 500px;">
                            <p style="padding-top: 20px"><i class="fa fa-bullseye" aria-hidden="true"></i>&nbsp; Explained</p>
                            <table>
                                {% for resource_info in family.resource_infos %}
                                <tr>
                                    <td class="actionAPI">{{ resource_info.api_name}}</td>
                                    <td>{{ resource_info.api_info }}</td>
                                </tr>
                                {% endfor %}
                            </table>
                        </div>
                        <div class="panel-section hidden" id="section3">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block extra_js%}
<script>
    var myVar = document.getElementById("myVar").value;
    document.getElementById("hashFrame").src="/analysis/"+myVar;
</script>
<script>
function printFrame() {
    var print_frame = document.getElementById("hashFrame").contentWindow;
    print_frame.focus();// focus on contentWindow is needed on some ie versions
    print_frame.print();
}
</script>
<script>

    var body_height = $("body").innerHeight();
    $("#hashFrame").height(body_height-300);

    $(function () {

        var viewer = ImageViewer({
            zoomValue: 100,
            maxZoom: 1000
        });
        $('.gallery-items').click(function () {
            var imgSrc = this.src,
                highResolutionImage = $(this).data('high-res-img');

            viewer.show(imgSrc, highResolutionImage);
        });
        var viewer2 = ImageViewer({
            zoomValue: 500,
            maxZoom: 2000
        });
        $('.profile-picture').click(function () {
            var imgSrc = this.src,
                highResolutionImage = $(this).data('high-res-img');

            viewer2.show(imgSrc, highResolutionImage);
        });
    });

    $('.vertical-nav li a').click(function(li) {
        $('a').removeClass('selected');
        $(this).addClass('selected');

        $('.panel-section').addClass('hidden');
        var target = $(this).attr("href");
        $(target).removeClass('hidden');
    });

</script>
{% endblock %}
</html>

